# leetcode_342 — 4 的冪（Power of Four）

本專案包含 LeetCode 題目 342（Power of Four）的三種常見解法實作與說明，示範如何用不同的思路判斷一個整數是否為 4 的冪。

## 簡介

題目：給定一個整數 `n`，若存在整數 `x` 使得 `n == 4^x`，則回傳 `true`，否則回傳 `false`。

範例：

- `n = 16` → `true`（16 = 4^2）
- `n = 5` → `false`

程式主檔案：`leetcode_342/Program.cs`（包含三種方法：`IsPowerOfFour`、`IsPowerOfFour2`、`IsPowerOfFour3`）。

## 三種解法詳解

以下內容以繁體中文（zh-TW）描述每種解法的直觀推理、步驟、範例、時間/空間複雜度，以及適用情境。

### 方法 A — 數學餘數 + 位元判斷：`IsPowerOfFour`

- 概念：若 `n` 為 4 的冪，則 `n` 是 2 的冪（二進位只有一個 1），且 `4^k - 1` 可被 3 整除。因此可結合位元檢查與模數檢查。
- 實作核心條件：`n > 0 && (n & (n - 1)) == 0 && (n - 1) % 3 == 0`
- 直觀步驟：
  1. 排除非正數。
  2. 用 `(n & (n - 1)) == 0` 檢查是否為 2 的冪。
  3. 檢查 `(n - 1) % 3 == 0`。
- 範例：`n = 16`：三個條件皆成立 → `true`。
- 複雜度：時間 O(1)，空間 O(1)。
- 優點：常數時間、簡潔、高效；不需要迴圈。
- 缺點：依賴數學性質，對某些讀者不直觀；需注意極端整數邊界（題目範圍內安全）。

### 方法 B — 迴圈乘四檢查：`IsPowerOfFour2`

- 概念：從 1 或 4 開始，逐步乘 4（或從 n 持續除 4）直到等於或超過目標值。
- 實作重點：先排除負數與處理 1，使用 `for (int i = 4; i <= n; i *= 4)` 或類似方式檢查。
- 直觀步驟：
  1. 若 `n < 0` → `false`；若 `n == 1` → `true`。
  2. 若 `n % 4 != 0` → `false`（快速剪枝）。
  3. 迴圈乘 4 比對 `i == n`。
- 範例：`n = 16`：4 → 16 → 找到 → `true`。
- 複雜度：時間 O(log_4 n) = O(log n)，空間 O(1)。
- 優點：直觀易懂，程式碼略為容易閱讀與推導。
- 缺點：不是常數時間；在極端情況需注意乘法溢位；效能不及 O(1) 解法。

### 方法 C — 位元遮罩（mask）判斷：`IsPowerOfFour3`

- 概念：若 `n` 是 4 的冪，二進位表示只有一個 1，且該 1 必定位於偶數位（從 0 起算）。先檢查是否為 2 的冪，接著用遮罩過濾奇數位。
- 實作核心條件：`n > 0 && (n & (n - 1)) == 0 && (n & 0xAAAAAAAA) == 0`
  - `0xAAAAAAAA`（二進位 `1010...`）在所有奇數位上為 1，與之 AND 為 0 代表沒有 1 在奇數位上。
- 直觀步驟：
  1. 排除非正數。
  2. 檢查是否為 2 的冪。
  3. 用遮罩確認唯一的 1 是否位於偶數位。
- 範例：`n = 16` → 通過遮罩測試 → `true`。
- 複雜度：時間 O(1)，空間 O(1)。
- 優點：常數時間且在位元層級上直觀判斷位元位置。
- 缺點：遮罩常數需與整數寬度對應；對不熟位元遮罩的讀者較不直觀；若改用 64-bit 型別需更換遮罩值。

## 三種方法比較（摘要）

- 正確性（在 `int` 範圍內）：三者皆能正確判斷。
- 性能（時間）：
  - `IsPowerOfFour` / `IsPowerOfFour3`：O(1)
  - `IsPowerOfFour2`：O(log_4 n) = O(log n)
- 可讀性：
  - 最直觀：`IsPowerOfFour2`（迴圈法）
  - 中等：`IsPowerOfFour`（結合位元與數學）
  - 需位元知識：`IsPowerOfFour3`（遮罩法）
- 實務建議：若追求效能與簡潔，選 `IsPowerOfFour` 或 `IsPowerOfFour3`（O(1)）；若做教學或示範演算法，先用 `IsPowerOfFour2`，再介紹 O(1) 優化。

## 注意事項與邊界

- 型別與遮罩：`IsPowerOfFour3` 使用 `0xAAAAAAAA` 為 32-bit 遮罩；若改用 `long` 或需要跨平台處理，請改用對應寬度的遮罩（例如 64-bit）。
- 溢位風險：`IsPowerOfFour2` 中 `i *= 4` 在某些語言或情境可能溢位，建議在乘法前檢查上界或使用除法策略（從 n 反向除以 4）。

## 小結與建議

- 面試或要最小時間複雜度：使用 `IsPowerOfFour`（易於表述）或 `IsPowerOfFour3`。
- 教學或閱讀性優先：使用 `IsPowerOfFour2` 作為入門範例，再介紹 O(1) 的優化。

---

如果你要，我可以接著新增：

- 單元測試檔案（驗證三種方法）
- 對 `Program.cs` 中註解做微幅補充

若沒問題，我會把第 4 項待辦標記為完成。
