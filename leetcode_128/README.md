# LeetCode 128 - Longest Consecutive Sequence

> 找出未排序整數陣列中最長連續序列的長度，要求時間複雜度 O(n)

## 題目說明

**難度：** Medium

**連結：**

- [LeetCode (English)](https://leetcode.com/problems/longest-consecutive-sequence/)
- [力扣 (中文)](https://leetcode.cn/problems/longest-consecutive-sequence/)

### 題目描述

給定一個**未排序**的整數陣列 `nums`，找出數字連續的最長序列（不要求序列元素在原陣列中連續）的長度。

請你設計並實現時間複雜度為 **O(n)** 的演算法解決此問題。

### 範例

```text
輸入：nums = [100, 4, 200, 1, 3, 2]
輸出：4
說明：最長連續序列是 [1, 2, 3, 4]，長度為 4
```

```text
輸入：nums = [0, 3, 7, 2, 5, 8, 4, 6, 0, 1]
輸出：9
說明：最長連續序列是 [0, 1, 2, 3, 4, 5, 6, 7, 8]，長度為 9
```

### 限制條件

- `0 <= nums.length <= 10^5`
- `-10^9 <= nums[i] <= 10^9`

---

## 解題思路

### 核心概念

這道題的關鍵挑戰在於**時間複雜度必須是 O(n)**，這意味著我們不能使用排序（排序至少需要 O(n log n)）。

#### 為什麼選擇 HashSet？

1. **O(1) 查詢時間**：HashSet 提供常數時間的查詢操作
2. **自動去重**：處理陣列中的重複數字
3. **無序特性**：我們不需要排序，只需要快速判斷某個數字是否存在

### 解題關鍵：找到序列起點

> [!IMPORTANT]  
> 演算法的核心在於**只從連續序列的起點開始計算**，避免重複計算。

**如何判斷一個數字是序列起點？**

如果 `num - 1` 不存在於集合中，則 `num` 就是一個連續序列的起點。

舉例說明，對於序列 `[1, 2, 3, 4]`：

- 檢查 `4`：因為 `3` 存在 → 不是起點
- 檢查 `3`：因為 `2` 存在 → 不是起點
- 檢查 `2`：因為 `1` 存在 → 不是起點
- 檢查 `1`：因為 `0` 不存在 → **是起點** ✓

這樣可以確保每個連續序列只被計算一次！

---

## 演算法步驟

```text
┌─────────────────────────────────────────────────────────┐
│  步驟 1：建立 HashSet 儲存所有數字（自動去重）            │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  步驟 2：遍歷 HashSet 中的每個數字                        │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  步驟 3：判斷是否為序列起點（num - 1 不存在）             │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  步驟 4：從起點向後計算連續數字的長度                     │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  步驟 5：更新並回傳最長序列長度                           │
└─────────────────────────────────────────────────────────┘
```

### 複雜度分析

| 類型 | 複雜度 | 說明                                  |
|------|--------|---------------------------------------|
| 時間 | O(n)   | 雖有巢狀迴圈，但每個數字最多被訪問 2 次 |
| 空間 | O(n)   | HashSet 需要儲存所有數字               |

---

## 詳細範例演示

以 `nums = [100, 4, 200, 1, 3, 2]` 為例：

### Step 1：建立 HashSet

```text
原始陣列：[100, 4, 200, 1, 3, 2]
HashSet：{100, 4, 200, 1, 3, 2}
```

### Step 2：遍歷並找起點

| 數字 | num - 1 存在？ | 是否為起點 | 動作     |
|------|----------------|------------|----------|
| 100  | 99 不存在      | ✓ 是       | 開始計數 |
| 4    | 3 存在         | ✗ 否       | 跳過     |
| 200  | 199 不存在     | ✓ 是       | 開始計數 |
| 1    | 0 不存在       | ✓ 是       | 開始計數 |
| 3    | 2 存在         | ✗ 否       | 跳過     |
| 2    | 1 存在         | ✗ 否       | 跳過     |

### Step 3：從各起點計算序列長度

**起點 100：**

```text
100 → 檢查 101 → 不存在 → 停止
序列長度 = 1
```

**起點 200：**

```text
200 → 檢查 201 → 不存在 → 停止
序列長度 = 1
```

**起點 1：**

```text
1 → 檢查 2 → 存在 ✓
2 → 檢查 3 → 存在 ✓
3 → 檢查 4 → 存在 ✓
4 → 檢查 5 → 不存在 → 停止
序列長度 = 4
```

### Step 4：比較並回傳結果

```text
最長序列：[1, 2, 3, 4]
回傳長度：4
```

---

## 程式碼實作

```csharp
public static int LongestConsecutive(int[] nums)
{
    // 建立 HashSet 儲存所有數字
    HashSet<int> numSet = new HashSet<int>(nums);
    int longestStreak = 0;

    foreach (int num in numSet)
    {
        // 只從序列起點開始計算
        if (!numSet.Contains(num - 1))
        {
            int currentNum = num;
            int currentStreak = 1;

            // 向後尋找連續數字
            while (numSet.Contains(currentNum + 1))
            {
                currentNum++;
                currentStreak++;
            }

            longestStreak = Math.Max(longestStreak, currentStreak);
        }
    }

    return longestStreak;
}
```

---

## 執行專案

### 環境需求

- .NET 10.0 或更高版本

### 建構與執行

```bash
# 建構專案
dotnet build

# 執行程式
dotnet run --project leetcode_128/leetcode_128.csproj
```

### 測試案例輸出

```text
Test 1 - 基本案例:
Input: [100, 4, 200, 1, 3, 2]
Output: 4

Test 2 - 空陣列:
Input: []
Output: 0

Test 3 - 重複數字:
Input: [1, 2, 0, 1, 3, 2, 5, 2, 4]
Output: 6

Test 4 - 不連續數字:
Input: [2, 4, 6, 8, 10]
Output: 1

Test 5 - 包含負數:
Input: [-5, -3, -2, -1, -4, 0, 2, 4]
Output: 6
```

---

## 相關題目

- [LeetCode 298 - Binary Tree Longest Consecutive Sequence](https://leetcode.com/problems/binary-tree-longest-consecutive-sequence/)
- [LeetCode 549 - Binary Tree Longest Consecutive Sequence II](https://leetcode.com/problems/binary-tree-longest-consecutive-sequence-ii/)
