# Fruits Into Baskets III

[!NOTE]
本專案為 LeetCode 第 3479 題「水果成籃 III」的 C# 解法，並採用分塊優化技巧處理大規模資料。

## 專案簡介

本專案提供一個高效能演算法，解決「每種水果只能放入容量足夠的最左邊可用籃子」的問題，並統計無法放置的水果種類數量。程式採用 C# 12，並遵循最佳程式設計規範。

- 題目連結：[LeetCode 3479](https://leetcode.com/problems/fruits-into-baskets-iii/description/?envType=daily-question&envId=2025-08-06)
- 中文題目：[LeetCode CN 3479](https://leetcode.cn/problems/fruits-into-baskets-iii/description/?envType=daily-question&envId=2025-08-06)

## 快速開始

```bash
# 建構專案
$ dotnet build

# 執行範例
$ dotnet run --project leetcode_3479/leetcode_3479.csproj
```

## 範例輸入/輸出

```csharp
int[] fruits = {2, 3, 5};
int[] baskets = {3, 4, 5};
int result = NumOfUnplacedFruits(fruits, baskets); // result = 0
```

## 解法說明

### 問題本質

每種水果必須放入容量足夠的最左邊可用籃子，每個籃子只能用一次。若無法放入，則計入「無法放置」種類。

### 分塊優化（Block Decomposition）

為提升查詢效率，程式將籃子陣列分成多個區塊，每個區塊維護最大容量資訊，能快速排除不可能的區塊，減少不必要的遍歷。

#### 步驟詳解

1. **分塊初始化**
   - 計算分塊大小 `m = sqrt(n)`，分塊數量 `section = (n + m - 1) / m`。
   - 建立 `maxValues` 陣列，記錄每個分塊的最大容量。
   - 遍歷所有籃子，根據分塊編號 `i / m`，更新該分塊最大值。

2. **水果放置流程**
   - 依序處理每種水果，目標是將其放入最左邊且容量足夠的可用籃子。
   - 對每個水果，依序檢查每個分塊：
     - 若分塊最大值小於水果數量，代表該分塊所有籃子都不夠大，直接跳過。
     - 否則在分塊內逐一檢查每個籃子，尋找最左邊可用且容量足夠的籃子。
     - 找到後將該籃子容量設為 0（表示已被佔用），並即時更新分塊最大值。
     - 若所有分塊都無法放置，則計數器加一。

3. **最大值即時更新**
   - 每次有籃子被佔用，分塊最大值都要重新計算，確保後續查詢正確。
   - 這樣設計能確保分塊查詢的正確性與效率。

4. **回傳結果**
   - 最終回傳無法放置的水果種類數量。

#### 範例流程

假設 `fruits = [2, 3, 5]`，`baskets = [3, 4, 5]`：
- 2 可放入 3（最左邊可用），3 可放入 4，5 可放入 5，全部都能放置，回傳 0。
- 若 `baskets = [2, 2, 2]`，則 3、5 都無法放置，回傳 2。

#### 時間複雜度分析

- 分塊大小約為 `sqrt(n)`，每種水果最多搜尋 `sqrt(n)` 個分塊，每塊最多搜尋 `sqrt(n)` 個籃子。
- 整體複雜度約為 `O(n + m * sqrt(n))`，其中 `m` 為水果種類數量，`n` 為籃子數量。

#### 設計優點

- 先用分塊最大值排除不可能的分塊，減少不必要的遍歷。
- 分塊內只找最左邊可用籃子，符合題目「最左」規則。
- 每次放置後即時更新分塊最大值，確保查詢正確。
- 只要有一個分塊能放置，該水果就算成功放置，否則計入「無法放置」種類。

#### 適用場景

分塊技巧常見於區間查詢、動態更新等場景，這裡用於「區間最大值」查詢，能顯著提升效率，尤其在籃子數量很大時。

> [!TIP]
> 本解法結合分塊查詢與即時更新，能有效處理大規模資料，並保證查詢效率與正確性。

## 目錄結構

```
leetcode_3479.sln
leetcode_3479/
    leetcode_3479.csproj
    Program.cs
    bin/
    obj/
```

## 聯絡方式

如需更深入原理、效能分析或程式碼註解，請參考程式內部 XML doc comments 或聯絡專案維護者。
