# 🥣 Leetcode 808: Soup Servings

> 動態規劃與機率遞推的經典範例

## 專案簡介

本專案為 Leetcode 808 題「Soup Servings」的 C# 解法，重點在於如何將機率問題轉化為動態規劃，並推導出正確的遞推公式。程式已內建多組測試資料，方便觀察不同 n 值下的機率變化。

---

## 題目描述

有兩種湯 A 和 B，每種最初都有 n 毫升。每回合隨機選擇以下四種操作之一（機率均為 0.25）：

1. A 減 100，B 不變
2. A 減 75，B 減 25
3. A 減 50，B 減 50
4. A 減 25，B 減 75

若某次操作超過剩餘量，則只倒出剩下的全部。只要有一種湯被倒完，過程即停止。

請返回「A 先倒完」的機率，加上「A 和 B 同時倒完」的機率的一半。

---

## 解法說明

### 狀態壓縮

由於每次操作都是 25 的倍數，可將 n 換算成 25 毫升為一單位的份數，將狀態空間大幅縮小。

### 狀態定義

- 設 dp[i][j] 表示 A 剩 i 份、B 剩 j 份時，最終答案的期望值。

### 狀態轉移（機率遞推公式）

每次有四種等機率選擇，分別對應到四個子狀態：

$$
dp[i][j] = 0.25 \times (dp[i-4][j] + dp[i-3][j-1] + dp[i-2][j-2] + dp[i-1][j-3])
$$

- 若 i 或 j 小於 0，視為 0（即已倒完）。

### 邊界條件

- $i \leq 0$ 且 $j \leq 0$：A、B 同時倒完，答案為 0.5
- $i \leq 0$ 且 $j > 0$：A 先倒完，答案為 1
- $i > 0$ 且 $j \leq 0$：B 先倒完，答案為 0

### 機率算法推導

- 每次操作後，A、B 的剩餘份數會進入四種新狀態，且每種狀態的機率均為 0.25。
- 遞推時，將所有可能的子狀態機率加總後平均，即可得到當前狀態的期望值。
- 本質上是「期望值的線性性」與「全概率公式」的應用。

#### 為什麼大 n 可以直接回傳 1？

- 每次 A 減的期望為 $(4+3+2+1)\times0.25=2.5$，B 減的期望為 $(0+1+2+3)\times0.25=1.5$。
- 當 n 很大時，A 幾乎必定比 B 先倒完，經驗上 n ≥ 179（即 4475 毫升）時，答案已經非常接近 1。

---

## 執行方式

```bash
# 建構
$ dotnet build

# 執行
$ dotnet run --project leetcode_808/leetcode_808.csproj
```

---

## 範例輸出

```
n = 50, 機率 = ...
n = 100, 機率 = ...
n = 200, 機率 = ...
n = 500, 機率 = ...
n = 1000, 機率 = ...
n = 5000, 機率 = ...
```

---

> [!TIP]
> 本專案重點在於「機率型動態規劃」的正確建模與推導，適合練習 DP 與機率遞推的同學參考。
